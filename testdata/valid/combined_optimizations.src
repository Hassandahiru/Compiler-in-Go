package main

// This file tests interaction between constant folding and dead code elimination
// First pass: constant folding reveals dead code
// Second pass: dead code elimination removes it

func testConstantFoldingEnablesDeadCode() int {
    // After constant folding:
    // x = 100, y = 200, z = 300

    var x int = 50 + 50;         // Folds to 100
    var y int = x * 2;           // Folds to 200
    var z int = y + 100;         // Folds to 300

    // This uses y, so y's computation must be kept
    // But x and z are unused and should be eliminated
    return y;
}

func testDeadConstantExpressions() int {
    // All of these fold to constants
    var a int = 10 * 10;         // 100
    var b int = 20 + 30;         // 50
    var c int = 15 - 5;          // 10

    // But only c is used
    // After folding: a=100, b=50, c=10
    // After DCE: only c remains
    return c;
}

func testComplexInteraction() int {
    // Step 1: Constant folding
    var const1 int = 5 * 5;      // Folds to 25
    var const2 int = 10 + 10;    // Folds to 20

    // Step 2: This uses const1, so const1's definition stays
    var used int = const1 * 2;   // Becomes: 25 * 2 = 50

    // const2 is never used - DCE removes it

    // Step 3: This computation is done but result unused
    var temp int = used + 100;   // Computed but not used - DCE removes

    // Only this survives
    return used;
}

func testNestedFolding() int {
    // Multi-level constant propagation
    var a int = 2;
    var b int = a + 3;           // Folds to 5
    var c int = b * 4;           // Folds to 20
    var d int = c - 5;           // Folds to 15

    // e and f are unused - should be eliminated
    var e int = 100;
    var f int = e * 2;

    return d;                     // Returns 15
}

func testAllOptimizations() int {
    // Constants that fold
    var x int = 3 + 7;           // 10
    var y int = 4 * 5;           // 20
    var z int = 100 - 50;        // 50

    // Unused constant
    var unused int = 777;

    // Used in computation
    var result int = x + y;      // 10 + 20 = 30

    // z and unused should be eliminated
    // x and y should be folded then used

    return result;
}

func main() {
    var r1 int = testConstantFoldingEnablesDeadCode();
    var r2 int = testDeadConstantExpressions();
    var r3 int = testComplexInteraction();
    var r4 int = testNestedFolding();
    var r5 int = testAllOptimizations();
}
